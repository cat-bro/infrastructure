pipeline {
  agent any

  stages {
    stage('Build') {
      environment {
          EXTRA_VARS='--extra_vars "ansible_user=jenkins_bot"'
      }
      steps {
        sh 'source jenkins/utils.sh'
        sh 'echo false_password > .vault_pass.txt'
        sh 'activate_virtualenv'
        sshagent (credentials: ['galaxy-au-tools-jenkins-bot ssh key']) {
          withCredentials([file(credentialsId: '.vault_pass.txt', variable: 'VAULT_PASS')])
            sh 'ansible-playbook -i hosts staging_update_configs_playbook.yml $EXTRA_VARS'
          }
      }
    }
  }
}
