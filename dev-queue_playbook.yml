- hosts: dev_slurm_head
  become: true
  vars_files:
      - group_vars/all.yml
      - group_vars/dev.yml
      - group_vars/rabbitservers.yml
      - group_vars/VAULT
      - host_vars/dev-queue.usegalaxy.org.au.yml
      - group_vars/dev_slurm.yml
  roles:
      - common
      - insspb.hostname
      - geerlingguy.pip
      - jasonroyle.rabbitmq
      - galaxyproject.nginx
      - mariadb
      - galaxyproject.repos
      - galaxyproject.slurm
  post_tasks:
      - name: Allow all users to run sudo sacct, scontrol or scancel
        lineinfile:
          path: /etc/sudoers.d/devs
          create: true
          line: "%devs ALL=(ALL) NOPASSWD: {{ item }}"
          validate: /usr/sbin/visudo -cf %s
        with_items:
          - /usr/bin/sacct
          - /usr/bin/scontrol
          - /usr/bin/scancel